<!DOCTYPE html>
<html>
  <head>
    <link href="css/style.css" rel="stylesheet" type="text/css">
  </head>
  <body>
      <p><a href="https://github.com/omcljs/om">Om</a> is used to create the first three examples on <a href="https://https://facebook.github.io/react/">Facebook's React</a> github page.</p>
      <div id="examples">
      <table>
          <tr><td>
                      <h2>A Simple Component</h2>
          <div id="helloExample">
              <div id="helloCode">
                  <textarea readonly rows="12" cols="50">
(def hello-app-state (atom {:text "Hello "}))

(defn hello-view [data owner]
  (reify
    om/IInitState
    (init-state [_]
                {:hello (str (:text data) "World" "!!!")})

    om/IRenderState
    (render-state [_ state]
                  (dom/h3 nil (:hello state)))))

                  </textarea>
              </div></td>
              <td><div id="hello"></div></td>
          </div></tr>

          <tr><td>
              <div style="background-color:#cccccc;">
                  <h2>A Stateful Component</h2></div>
          <div id="timerExample">
              <div id="timerCode">
                  <textarea readonly rows="25" cols="60" style="background-color:#cccccc;">
(def timer-app-state (atom {:secondsElapsed 0}))

(defn tick [data]
  (om/update! data [:secondsElapsed] (inc (@data :secondsElapsed))))

(defn seconds-view [seconds owner]
  (reify
    om/IRender
    (render [this]
             (dom/h2 nil (str "Elapsed time: " seconds)))))

(defn timer-view [data owner]
  (reify
    om/IDidMount
    (did-mount [_]
                (js/setInterval #(tick data) 1000))

    om/IRender
    (render [this]
            (dom/div #js {:className "timer"}
            (dom/h1 nil "The Timer")
            (dom/h2 nil (om/build seconds-view (:secondsElapsed data)))))))                  </textarea>
              </td></div>
                            <td><div id="timer" style="background-color:#cccccc;"></td></div>
    </div></tr>

          <tr><td>
              <h2>An Application</h2>
          <div id="todoExample">
              <div id="todoCode">
                  <textarea readonly rows="40" cols="60">
(def list-app-state (atom {:items [] :index 1 :text ""}))

(defn add-item [data owner]
  (let [new-item (-> (om/get-node owner "new-item")
                        .-value)]
    (when (not= "" new-item)
      (om/transact! data :items #(conj % new-item))
      (om/transact! data :index inc)
      (om/set-state! owner :text ""))))

(defn item-view [item owner]
  (reify
    om/IRender
    (render [this]
      (dom/li nil item))))

(defn todo-list-view [data owner]
  (reify
    om/IInitState
    (init-state [_]
      {:items [] :index 1 :text ""})

    om/IRenderState
    (render-state [this state]
      (dom/div nil
        (dom/h1 nil "TODO")

        (apply dom/ul nil
          (om/build-all item-view (:items data)
            {:init-state state}))

        (dom/div nil
          (dom/input #js {:type "text" :ref "new-item" :value (:text state)
                          :onChange (fn [x])})

          (dom/button #js {:onClick #(add-item data owner)}
                      (str "Add item #" (:index data))))))))
                  </textarea>
              </div></td>
              <td><div id="todoList"></div></td></tr>
          </div>

      </table>
      </div>
<h2>Main Routine</h2>
      <textarea readonly rows="10" cols="50">
(defn main []
  (om/root hello-view hello-app-state
    {:target (. js/document (getElementById "hello"))})

  (om/root timer-view timer-app-state
    {:target (. js/document (getElementById "timer"))})

  (om/root todo-list-view list-app-state
    {:target (. js/document (getElementById "todoList"))}))
      </textarea>

    <script src="/js/app.js" type="text/javascript"></script>
  </body>
</html>
